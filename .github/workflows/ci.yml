# This is a basic workflow to help you get started with Actions

name: ${{ github.event.inputs.name }}

# Controls when the workflow will run
on:
  workflow_dispatch:
    inputs:
      name:
        description: "Name"
        required: true
        default: "macOS"
      macos_version:
        type: choice
        description: "macOS Version"
        required: true
        options:
          - Monterey v12.4
          - Big Sur v11.6.8
          - Catalina v10.15.7
          - Mojave v10.14.6
          - High Sierra v10.13.6
          - Ventura Beta v13.0
          - Monterey Beta v12.5
      format:
        type: choice
        description: "Download Format"
        required: true
        options:
          - DMG File
          - ISO File
          - ZIP File

jobs:
  build-n-upload:
    runs-on: macos-latest

    steps:
      - uses: actions/checkout@v3

      # MARK: macOS Version

      - if: github.event.inputs.macos_version == 'Monterey v12.4'
        name: Download macOS Monterey Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 12.4

      - if: github.event.inputs.macos_version == 'Big Sur v11.6.8'
        name: Download macOS BigSur Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 11.6.8

      - if: github.event.inputs.macos_version == 'Catalina v10.15.7'
        name: Download macOS Catalina Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 10.15.7

      - if: github.event.inputs.macos_version == 'Mojave v10.14.6'
        name: Download macOS Mojave Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 10.14.6

      - if: github.event.inputs.macos_version == 'High Sierra v10.13.6'
        name: Download macOS HighSierra Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 10.13.6

      - if: github.event.inputs.macos_version == 'Ventura Beta v13.0'
        name: Download macOS Ventura Beta Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 13.0

      - if: github.event.inputs.macos_version == 'Monterey Beta v12.5'
        name: Download macOS MontereyBeta Latest
        run: |
          sudo "/System/Library/PrivateFrameworks/Seeding.framework/Versions/Current/Resources/seedutil" enroll DeveloperSeed
          sleep 5
          softwareupdate --fetch-full-installer --full-installer-version 12.5

      # MARK: File Format

      # MARK: DMG

      # Monterey DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'Monterey v12.4'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Monterey -size 16384m -volname Monterey -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Monterey.dmg -noverify -mountpoint /Volumes/Monterey
          sudo /Applications/Install\ macOS\ Monterey.app/Contents/Resources/createinstallmedia --volume /Volumes/Monterey --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Monterey
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Monterey
          path: "/tmp/Monterey.dmg"

      # Big Sur DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'Big Sur v11.6.8'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/BigSur -size 16384m -volname BigSur -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/BigSur.dmg -noverify -mountpoint /Volumes/BigSur
          sudo /Applications/Install\ macOS\ Big\ Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/BigSur --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Big\ Sur
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Big Sur
          path: "/tmp/BigSur.dmg"

      # Catalina DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'Catalina v10.15.7'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Catalina -size 16384m -volname Catalina -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Catalina.dmg -noverify -mountpoint /Volumes/Catalina
          sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/Catalina --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Catalina
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Catalina
          path: "/tmp/Catalina.dmg"

      # Mojave DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'Mojave v10.14.6'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Mojave -size 16384m -volname Mojave -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Mojave.dmg -noverify -mountpoint /Volumes/Mojave
          sudo /Applications/Install\ macOS\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/Mojave --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Mojave
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Mojave
          path: "/tmp/Mojave.dmg"

      # High Sierra DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'High Sierra v10.13.6'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/HighSierra -size 16384m -volname HighSierra -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/HighSierra.dmg -noverify -mountpoint /Volumes/HighSierra
          sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/HighSierra --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ High\ Sierra
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS High Sierra
          path: "/tmp/HighSierra.dmg"

      # Ventura Beta DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'Ventura Beta v13.0'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Ventura -size 16384m -volname Ventura -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Ventura.dmg -noverify -mountpoint /Volumes/Ventura
          sudo /Applications/Install\ macOS\ 13\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/Ventura --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ 13\ Beta
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Ventura Beta
          path: "/tmp/Ventura.dmg"

      # Monterey Beta DMG

      - if: |
          github.event.inputs.format == 'DMG File' ||
          github.event.inputs.macos_version == 'Monterey Beta v12.5'
        name: DMG and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Monterey -size 16384m -volname Monterey -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Monterey.dmg -noverify -mountpoint /Volumes/Monterey
          sudo /Applications/Install\ macOS\ 12\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/Monterey --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ 12\ Beta
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Monterey Beta
          path: "/tmp/Monterey.dmg"

      # MARK: ISO

      # Monterey ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'Monterey v12.4'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Monterey -size 16384m -volname Monterey -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Monterey.dmg -noverify -mountpoint /Volumes/Monterey
          sudo /Applications/Install\ macOS\ Monterey.app/Contents/Resources/createinstallmedia --volume /Volumes/Monterey --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Monterey
          hdiutil convert /tmp/Monterey.dmg -format UDTO -o ~/Desktop/Monterey
          mv -v ~/Desktop/Monterey.cdr ~/Desktop/Monterey.iso
          sudo rm -fv /tmp/Monterey.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Monterey
          path: "~/Desktop/Monterey.iso"

      # Big Sur ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'Big Sur v11.6.8'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/BigSur -size 16384m -volname BigSur -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/BigSur.dmg -noverify -mountpoint /Volumes/BigSur
          sudo /Applications/Install\ macOS\ Big\ Sur.app/Contents/Resources/createinstallmedia --volume /Volumes/BigSur --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Big\ Sur
          hdiutil convert /tmp/BigSur.dmg -format UDTO -o ~/Desktop/BigSur
          mv -v ~/Desktop/BigSur.cdr ~/Desktop/BigSur.iso
          sudo rm -fv /tmp/BigSur.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Big Sur
          path: "~/Desktop/BigSur.iso"

      # Catalina ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'Catalina v10.15.7'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Catalina -size 16384m -volname Catalina -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Catalina.dmg -noverify -mountpoint /Volumes/Catalina
          sudo /Applications/Install\ macOS\ Catalina.app/Contents/Resources/createinstallmedia --volume /Volumes/Catalina --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Catalina
          hdiutil convert /tmp/Catalina.dmg -format UDTO -o ~/Desktop/Catalina
          mv -v ~/Desktop/Catalina.cdr ~/Desktop/Catalina.iso
          sudo rm -fv /tmp/Catalina.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Catalina
          path: "~/Desktop/Catalina.iso"

      # Mojave ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'Mojave v10.14.6'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Mojave -size 16384m -volname Mojave -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Mojave.dmg -noverify -mountpoint /Volumes/Mojave
          sudo /Applications/Install\ macOS\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/Mojave --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ Mojave
          hdiutil convert /tmp/Mojave.dmg -format UDTO -o ~/Desktop/Mojave
          mv -v ~/Desktop/Mojave.cdr ~/Desktop/Mojave.iso
          sudo rm -fv /tmp/Mojave.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Mojave
          path: "~/Desktop/Mojave.iso"

      # High Sierra ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'High Sierra v10.13.6'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/HighSierra -size 16384m -volname HighSierra -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/HighSierra.dmg -noverify -mountpoint /Volumes/HighSierra
          sudo /Applications/Install\ macOS\ High\ Sierra.app/Contents/Resources/createinstallmedia --volume /Volumes/HighSierra --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ High\ Sierra
          hdiutil convert /tmp/HighSierra.dmg -format UDTO -o ~/Desktop/HighSierra
          mv -v ~/Desktop/HighSierra.cdr ~/Desktop/HighSierra.iso
          sudo rm -fv /tmp/HighSierra.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS High Sierra
          path: "~/Desktop/HighSierra.iso"

      # Ventura Beta ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'Ventura Beta v13.0'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Ventura -size 16384m -volname Ventura -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Ventura.dmg -noverify -mountpoint /Volumes/Ventura
          sudo /Applications/Install\ macOS\ 13\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/Ventura --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ 13\ Beta
          hdiutil convert /tmp/Ventura.dmg -format UDTO -o ~/Desktop/Ventura
          mv -v ~/Desktop/Ventura.cdr ~/Desktop/Ventura.iso
          sudo rm -fv /tmp/Ventura.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Ventura Beta
          path: "~/Desktop/Ventura.iso"

      # Monterey Beta ISO

      - if: |
          github.event.inputs.format == 'ISO File' ||
          github.event.inputs.macos_version == 'Monterey Beta v12.5'
        name: ISO and Upload
        run: |
          cd /Applications
          sudo hdiutil create -o /tmp/Monterey -size 16384m -volname Monterey -layout SPUD -fs HFS+J
          sudo hdiutil attach /tmp/Monterey.dmg -noverify -mountpoint /Volumes/Monterey
          sudo /Applications/Install\ macOS\ 12\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/Monterey --nointeraction
          hdiutil eject -force /Volumes/Install\ macOS\ 12\ Beta
          hdiutil convert /tmp/Monterey.dmg -format UDTO -o ~/Desktop/Monterey
          mv -v ~/Desktop/Monterey.cdr ~/Desktop/Monterey.iso
          sudo rm -fv /tmp/Monterey.dmg
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Monterey Beta
          path: "~/Desktop/Monterey.iso"

      # MARK: ZIP

      # Monterey ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'Monterey v12.4'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS Monterey.zip" "Install macOS Monterey.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Monterey
          path: "/Applications/Install macOS Monterey.zip"

      # Big Sur ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'Big Sur v11.6.8'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS Big Sur.zip" "Install macOS Big Sur.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Big Sur
          path: "/Applications/Install macOS Big Sur.zip"

      # Catalina ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'Catalina v10.15.7'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS Catalina.zip" "Install macOS Catalina.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Catalina
          path: "/Applications/Install macOS Catalina.zip"

      # Mojave ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'Mojave v10.14.6'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS Mojave.zip" "Install macOS Mojave.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Mojave
          path: "/Applications/Install macOS Mojave.zip"

      # High Sierra ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'High Sierra v10.13.6'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS High Sierra.zip" "Install macOS High Sierra.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS High Sierra
          path: "/Applications/Install macOS High Sierra.zip"

      # Ventura Beta ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'Ventura Beta v13.0'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS 13 Beta.zip" "Install macOS 13 Beta.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Ventura Beta
          path: "/Applications/Install macOS 13 Beta.zip"

      # Monterey Beta ZIP

      - if: |
          github.event.inputs.format == 'ZIP File' ||
          github.event.inputs.macos_version == 'Monterey Beta v12.5'
        name: ZIP and Upload
        run: |
          cd /Applications
          zip -r "Install macOS 12 Beta.zip" "Install macOS 12 Beta.app"
      - uses: actions/upload-artifact@v3.1.0
        with:
          name: macOS Monterey Beta
          path: "/Applications/Install macOS 12 Beta.zip"
